<html>
	<head>
		<title>31절모의고사</title>
    	<link rel='stylesheet' href='/stylesheets/style.css' />
    <script type="text/javascript" src="https://jsgetip.appspot.com"></script>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<link rel="stylesheet" href="/stylesheets/fontawsome/css/all.min.css">
    <link rel="stylesheet" href="stylesheet.css" type="text/css" charset="utf-8" />
		<style>
		  body{
        font-family: 'rokgr';
      }
		</style>
		<script>
		window.fbAsyncInit = function() {
			FB.init({
			appId            : '652592155551719',
			autoLogAppEvents : true,
			xfbml            : true,
			version          : 'v6.0'
			});
		};
		</script>
		<script async defer src="https://connect.facebook.net/en_US/sdk.js"></script>
			
		<script>
		  FB.init({
			appId: '652592155551719', //replace with your app ID
			version: 'v2.7'
		}); 
		  </script>

	</head>
	<body>
		<div class="qz">
    
			<div class="qzbody qzstartpage">
				<div class="qzcontbx">
					<br>
					삼일절 프로젝트
					<h1>
						독립운동<br>OX퀴즈
					</h1>
					문제는 단 10문제<br>10초 안에 못 맞추면 탈락!
				</div>
				<div class="qzbtnboxst rlqzpage">
					<button class="btn btn-howto" onclick='howto(1)'>게임방법</button>
					<button class="btn btn-startbtn" onclick='start()'>시작</button>
				</div>
			</div>
			<div class="howtoplay shadow">
				<div class="howtocont">
					<strong style="color: blue;">문제 풀이 관련</strong>
					<br>
					<ul>
						<li>모든 문제는 <span style="color: blue;">OX 문제</span> 입니다.</li>
						<li>모든 문제의 제한 시간은 <span style="color: blue;">10초</span> 입니다.</li>
						<li>모든 문제를 맞출시 <span style="color: blue;">바나나우유 기프티콘</span>을 추첨으로 총 72분께 전달해 드립니다.</li>
						<li>만약, 한 문제라도 틀릴시 상품을 받을 수 없으며, <span style="color: blue;">SNS 공유하기를</span> 통하여 부활이 가능합니다.</li>
					</ul>
				</div>
				<div class="qzbtnbox"> 
					<button class="btn btn-howtocls" onclick='howto(0)'>닫기</button>
				</div>
			</div>
			<div class="qzbody qzpage">
				<div class="qzcontbx">
					<div class="qznum shadow">
						
					</div>
					<div class="qzshow">
						
					</div>
				</div>  
				<div class="qztimer">
					<div class="stopwcpg">
						<div class="stbtn1">
								
						</div>
						<div class="stbtn2">

						</div>
						<div class="stbt2mx">
							<div class="stbmf1">

							</div>
							<div class="stbmf2">

							</div>
						</div>
						<div class="stopwccc">
							<div class="stopwcccin">
								<div class="stopwcccinbb">

								</div>
							</div>
						</div>
						<div class="stopbane">

						</div>
					</div>
					<div class="timebody">
						<div class="timebar">
							
						</div>
					</div>
				</div>
				<div class="qzbtnbox"> 
					<button class="btn btn-qzsel qzo" onclick="ckqz('O')">O</button>
					<button class="btn btn-qzsel qzx" onclick="ckqz('X')">X</button>
				</div>
			</div>
		</div>
		<div class="qzbody awpageo">
			<div class="qzcontbx">
				<div class="awwt shadow">
					<i class="fas fa-check"></i>
				</div>
				<div class="awshow">
					
				</div>
			</div>
			<div class="qzbtnbox"> 
				<button class="btn btn-nxqz" onclick="nextqz()">다음문제</button>
			</div>
		</div>
		<div class="qzbody awpagex">
			<div class="qzcontbx">
				<div class="awwt shadow awfail">
					<i class="fas fa-times"></i>
				</div>
				<div class="awshow">
					
				</div>
			</div>
			<div class="qzbtnbox"> 
				<button class="btn btn-qzsel qzo" onclick="shareovertog()">이어하기</button>
				<button class="btn btn-qzsel qzx" onClick="window.location.reload()" >처음부터</button>
			</div>
		</div>
		<div class="qzbody allcomplet">
      
			<div class="qzcontbx"><div class="awwt shadow"><i class="fas fa-check"></i></div>
				<div class="complet">
					문제를 모두 맞추셨습니다!
					<p style="font-size:15px" >
						아래의 양식을 작성하여 선물을 받으세요!
					</p>
          <div style="text-align: left; font-family: 'Noto Sans KR'; font-size: 15pt;" class="form">
            <div class="form-group">
              <label for="exampleFormControlInput1" class="form">이름</label>
              <input  class="form-control" id="name" placeholder="이름을 입력하세요.">
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput1">전화번호</label>
              <input type="number" class="form-control" id="phone" placeholder="전화번호를 입력하세요. ( '-' 제외)">
            </div>

            <div class="form-group">
              <label for="exampleFormControlTextarea1">개인정보처리방침</label>
              <textarea class="form-control" id="exampleFormControlTextarea1" style="height:15%;" rows="3">
[개인정보의 수집·이용]
1. 개인정보의 수집·이용 목적: 이벤트 진행, 경품 발송 및 중복참여제한
2. 수집하는 개인정보의 항목: 이름, 휴대폰번호
3. 개인정보의 보유·이용 기간:  이벤트 종료 후 즉시 파기
개인정보의 수집 및 이용에 대한 동의를 거부할 수 있으며, 이 경우 이벤트 참여가 제한됩니다.

[개인정보의 처리위탁]
1. 개인정보 받는 자: 11번가(주), 구름
2. 업무: 이벤트 경품 발송
              </textarea>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="privacy">
              <label class="form-check-label" style="font-size: 13pt;" for="defaultCheck1">
                개인정보의 제공에 동의합니다.
              </label>
            </div>
            <br>
            <button type="button" class="btn btn-primary btn-lg btn-block" onClick="submit()">응모하기</button>
          </div>
				</div>
        
			</div>
			
    
		</div>
		
		<div class="shareover">
			SNS에 삼일고사를 공유해 부활할 수 있습니다.<br>공유할 곳을 선택해 주세요.
			<div class="qzbtnbox"> 
				<a class="btn btn-qzsel shk" id="kakao-link-btn" href="javascript:sendLink()">카카오톡</a>
				<a class="btn btn-qzsel shf" href="https://www.facebook.com/sharer/sharer.php?u=31jeol.com" target="_blank" onclick="shareclicked()">페이스북</a>
				<script type='text/javascript'>
					
					function getData() {
						$.ajax({
							url: '/isdone',
							type : "POST",
							data: {
								key:usrId
							}
						}).done(function(results) {
							
							if(results == 'done') {
								shared();
								clearInterval(Timer);
								
							} 
						}).fail(function(results) {
							alert("서버 내부오류가 발생하였습니다. 나중에 다시시도 하시거나,\n'문의하기'를 통해 개발팀에 문의해주시면 최선을 다해 지원하겠습니다.\n불편을 드려 대단히 죄송합니다.")
						});
					}
					function getRandomArbitrary(min, max) {
						min = Math.ceil(min);
						max = Math.floor(max);
						return Math.floor(Math.random() * (max - min)) + min; //최댓값은 제외, 최솟값은 포함
					}
					Kakao.init('12e14f3cee6ea871544d6ecd7f7de8ca');
					var usrId = getRandomArbitrary(1111,9999);
					function sendLink() {
					  Kakao.Link.sendDefault({
						objectType: 'feed',
						content: {
						  title: 'Memorial31',
						  description: '삼일절을 맞이하여 구름에서 3.1 상식 퀴즈를 준비했어요! 시험을 통과하면 시원한 바나나우유도 추첨 지급합니다!',
						  imageUrl: 'https://cdn.discordapp.com/attachments/677064563841302528/683302184602828819/2.png',
						  link: {
							mobileWebUrl: 'https://developers.kakao.com',
							webUrl: 'https://developers.kakao.com'
						  }
						},
						buttons: [
						  {
							title: '31고사 치러가기',
							link: {
							  mobileWebUrl: 'https://31jeol.com',
							  webUrl: 'https://31jeol.com'
							}
						  },
						],
						serverCallbackArgs: '{"key":' + usrId + '}',
						callback : function(){
							shared();
						}
					  });
					  var Timer = setInterval(getData, 1000);
					}

				  //]]>
				</script>
			</div>
		</div>
		
		<div class="shareovered">
			부활 성공!
			<div class="qzbtnbox"> 
				<button class="btn btn-startbtn" onclick="relive()">부활하기</button>
			</div>
		</div>
    
		<script>
			var q=[], a=[], qa=[], id=[];
		</script>
		<script>
			<% for(var i =0;i<10;i++) { %>
				q[<%- i%>]="<%- quiz[i].q%>";
				a[<%- i%>]="<%- quiz[i].a%>";
				qa[<%- i%>]="<%- quiz[i].qa%>";
			<% } %>
		</script>
		<script>
			$('.qzpage').hide();
			$('.howtoplay').hide();
			$('.awpageo').hide();
			$('.awpagex').hide();
			$('.allcomplet').hide();
			$('.shareover').hide();
			$('.shareovered').hide();
			
			var shareck=0;
			function shareclicked() {
				FB.ui({
					method: 'share',
					href: 'https://31jeol.com',
				}, function(response) {
				
					console.log(response);
					if (response) {
						shared();
					} else {
						alert('공유되지 않았습니다. 다시 시도해주세요.');
					}
				});
			}
			
			function shared() {
				shareck=0;
				$('.shareover').hide();
				$('.shareovered').show();
				//nextqz();
				//$('.awpagex').hide();
				//$('.shareovered').show();
			}
			
			function relive() {
				$('.awpagex').hide();
				$('.shareovered').hide();
				nextqz();
			}
			
			function shareovertog() {
				$('.shareover').show();
			}

			var quiz=1;
			var time=10;
			var persen="100%";
			var nameRegex = /^[가-힣]{2,5}$/;
			var phoneRegex = /^\d{11}$/;
			function start() {
				makeqs();
				$('.qzstartpage').hide();
				$('.qzpage').show();
			}
			function makeqs() {
				$('.qznum').text(quiz);
				$('.qzshow').text(q[quiz-1]);
				time=10;
				timer = setInterval(function() {
					time--;
					persen=time*10;
					$('.timebar').width(persen+"%");
					if(time==0) {
						timeend();
					}
				}, 1000);
			}
			function timeend() {
				clearInterval(timer);
				aswer(0);
			}
			function ckqz(what) {
				clearInterval(timer);
				if(what==a[quiz-1]) {
					aswer(1);
				} else {
					aswer(0);
				}
			}
			function aswer(way) {
				$('.awshow').text(qa[quiz-1]);
				if(way==1) {
					$('.awpageo').show();
				} else {
					$('.awpagex').show();
				}
			}
			function howto(way) {
				if(way==1) {
					$('.howtoplay').show();
				} else {
					$('.howtoplay').hide();
				}
			}
			function nextqz() {
				if(quiz>=10) {
					$('.allcomplet').show();
				} else {
					quiz++;
					makeqs();
					$('.awpageo').hide();
				}
			}
      function submit() {
        var name = document.getElementById('name').value;
        var phone = document.getElementById('phone').value;
        var checkbox = document.getElementById('privacy').checked;
        if(!checkbox) {
          alert("개인정보처리방침에 동의하셔야 합니다.");
          return false;
        }
        if(!nameRegex.test(name)) {
          alert("이름은 한글 실명 2~4자만 입력할 수 있습니다.");
          return false;
        }
        if(!phoneRegex.test(phone)) {
          alert("휴대전화번호 형식이 올바르지 않습니다. '-'를 제외하고 입력하세요.");
          return false;
        }
        $.ajax({
          url: '/submit',
          type : "POST",
          data: {
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            ip: ip()
          }
        }).done(function(results) {
          if(results == 'already') {
            alert("1인(동일 IP 대역)당 1번만 응모할 수 있습니다.");
            
          } else {
            alert("응모가 성공적으로 완료되었습니다.");
            window.location.reload(); 
          } 
        }).fail(function(results) {
          alert("서버 내부오류가 발생하였습니다. 나중에 다시시도 하시거나,\n'문의하기'를 통해 개발팀에 문의해주시면 최선을 다해 지원하겠습니다.\n불편을 드려 대단히 죄송합니다.")
        });
      }

		</script>
	</body>
</html>